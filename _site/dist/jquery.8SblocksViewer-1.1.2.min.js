!function(a,b,c){"use strict";function d(b){var c=a("#"+b);c.css("width","100%");var d=c.width(),f=c.attr("data-presentation-frame-width"),g=Math.min(d/f,1);c.css({width:f+"px","-webkit-transform-origin":"0 0","-webkit-transform":"scale("+g+")","transform-origin":"0 0",transform:"scale("+g+")"}),"true"===c.attr("data-zoomable-annotation")&&c.parent().siblings(".b-figure").html("Displayed in viewport <span class='auto-zoom-width'>"+f+"px wide</span> @ <span class='auto-zoom-percentage'>"+Math.round(100*g)+"%</span> scale"),e(b)}function e(b){var c=a("#"+b);c.css("height","0");var d=c[0].contentWindow.document.documentElement.scrollHeight;c.css("height",d+"px");var e=c[0].getBoundingClientRect().height;c.parent().css({height:e+"px"})}function f(){a("iframe.auto-zoom").each(function(){d(a(this).attr("id"))})}function g(a,b){var c,d,e,f,g,i=h(function(){g=f=!1},b);return function(){c=this,d=arguments;var h=function(){e=null,g&&a.apply(c,d),i()};e||(e=setTimeout(h,b)),f?g=!0:a.apply(c,d),i(),f=!0}}function h(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}}var i=function(b,c){this.$el=a(b),this.config=null,this.opts=c,this.components=[],this.cache={},this.FRAME_CONTAINER_PADDING=28,this.RESPONSIVE_SIZES=["320x444","360x640","600x800","768x1024","800x1280","980x1280","1280x600","1900x900"],this.LOGGING=!0,this.loadConfig(c),this._setupLogging(),this.init()},j=function(a){this.cache={},this.page=a.page,this.config=this.page.config,this.index=a.index,this.init(a.component)};j.prototype={init:function(a){var b=this;b.$component=a,b.$revised_component="",b.template=b.$component.html(),b.width=parseInt(b.$component.attr("data-frame-width"),10),b.height=parseInt(b.$component.attr("data-frame-height"),10),b._setFrameName(),b._setFrameID(),b._setFrameContainerID(),b._setFrameProperties(),b._setFigure(),b.createFrame()},createFrame:function(){var a=this;a._createFrameComponents(),a._createFrame(),a._wrapFrame(),a._makeFrameResizable(),a._attachFrame(),a._setupAutoZoom(),d(a.id)},_createFrameComponents:function(){var b,c=this,d=a('<span data-object="blocks-doc-component-responsive_selector"></span>'),e=a("<select></select>");_.each(c.page.RESPONSIVE_SIZES,function(c){b=a("<option></option>"),b.attr("value",c).text(c),e.append(b)}),d.addClass("b-responsive_sizes").append(e),c.$responsive_selector=d},_createFrame:function(){var b=this;b.$frame=a("<iframe></iframe>"),b.$frame.attr("id",b.id),b.$frame.attr("src",b.config.viewer_template_uri),b.$frame.attr("frameborder","0"),b.$frame.attr("sandbox","allow-same-origin allow-forms allow-scripts"),b.$frame.attr("seamless",!0),b.$frame.attr("scrolling",b.frame_properties.scrollable),b.$frame.css("width","100%"),b.$frame.css("height","100%"),b.$frame.bind("load",function(){setTimeout(function(){window.document.getElementById(b.id).contentWindow.$("body").BlocksLoader()},800)})},_wrapFrame:function(){var b=this,c=a("<div></div>"),d=parseInt(b.page.FRAME_CONTAINER_PADDING+b.height,10),e=parseInt(b.page.FRAME_CONTAINER_PADDING+b.width,10),f=a("<div></div>"),g=a("<p></p>");b.$component.wrap(b.$frame),c.css("height",d),c.css("width",e),c.addClass("b-frame_container"),c.attr("id",b.frame_container_ID),a("#"+b.id).wrap(c),f.addClass("b-viewer_container"),g.addClass("b-figure").text(b.figure).append(b.$responsive_selector),a("#"+b.frame_container_ID).wrap(f),a("#"+b.frame_container_ID).parent().prepend(g)},_makeFrameResizable:function(){var b=this;"false"!==b.frame_properties.resizable?a("#"+b.frame_container_ID).resizable().parent().addClass("is-resizable"):a("#"+b.frame_container_ID).parent().find('[data-variation="component-responsive_selector"]').append('<span class="b-non_responsize_sizes">'+b.width+"x"+b.height+"</span>")},_setupAutoZoom:function(){var b=this,c=a("#"+b.id);"auto"==b.frame_properties.zoomable&&c.attr("data-presentation-frame-width",b.width).addClass("auto-zoom").parent(".b-frame_container").css("width","auto"),"true"===b.frame_properties["zoomable-annotation"]&&c.attr("data-zoomable-annotation","true")},_attachFrame:function(){var b,c=this,d=c._cleanComponent();setTimeout(function(){b=window.document.getElementById(c.id).contentWindow.document,c.$iframe=a("html",b),c.$iframe.find("body").append(d);var e=b.createElement("script");e.src=c.config.blocks_loader,b.head.appendChild(e)},500)},_cleanComponent:function(){var a=this,b=a.$component.clone(),c=b.attr("data-frame-component");return b.attr("data-component",c),b.removeAttr("data-frame-component"),b.removeAttr("data-frame-width"),b.removeAttr("data-frame-height"),void 0===b.attr("data-frame-variation")&&b.attr("data-frame-variation","default"),b},_setFrameID:function(){var a=this;a.id=a.$component.attr("id")?a.$component.attr("id"):a.name+"-"+a.index},_setFrameContainerID:function(){var a=this;a.frame_container_ID="container-"+a.id},_setFrameName:function(){var a=this;a.name=a.$component.attr("data-frame-component")+"-frame"},_setFrameProperties:function(){var a,b=this,c={width:"100%",height:"100%",resizable:!0,scale:"",scrollable:"no",zoomable:"true","zoomable-annotation":"true","zoom-levels":[1,.66,.5,.33]};b.frame_properties={},_.each(c,function(c,d){a="data-frame-"+d,void 0!==b.$component.attr(a)&&""!==b.$component.attr(a)?b.frame_properties[d]=b.$component.attr(a):void 0!==b.config.frame?void 0!==b.config.frame[d]&&(b.frame_properties[d]=b.config.frame[d]):b.frame_properties[d]=c})},_setFigure:function(){var a=this;a.figure=a.$component.attr("data-figure")},_wrapComponent:function(){var b,c=this,d=c.$component.html();void 0!==d&&d.length>0&&(b=a(d),c.$revised_component.empty(),b.find(".place-component-here").replaceWith(c.$revised_component.clone()),c.$revised_component=b)}},i.prototype={constructor:i,loadConfig:function(b){var c=this,d=b.config_path+"config.json",e={type:"GET",dataType:"json",async:!1,cache:!1,url:d,timeout:3e4,success:function(d){c.config=a.extend(b,d)},error:function(a){window.console.error("FAILED TO FETCH CONFIG: "+d+" returned "+JSON.stringify(a)),c.config=b}};a.ajax(e)},init:function(){var b=this,d=0;b.name=a(c).find("head title").text(),b._setTemplateURI(),b._enableJS(),b.$el.find("*[data-frame-component]").each(function(){var c;d++,c=new j({page:b,component:a(this),index:d})}),b._setupPage()},_setupPage:function(){var a=this;a._setupResponsiveSelector(),a._enableTabs()},_enableJS:function(){a(c).find("html").removeClass("no-js").addClass("js")},_enableTabs:function(){var b,c=this,d=c.$el.find('*[data-object="blocks-doc-component-tabs"]'),e=d.find('[data-state="is-active"]'),f=function(a){var b=a.attr("data-target"),c=a.parent().parent().find(b);c.siblings().attr("data-state","is-inactive"),c.attr("data-state","is-active")},g=function(a){a.siblings().attr("data-state","is-inactive"),a.attr("data-state","is-active")};f(e),c.$el.on("click",'*[data-object="blocks-doc-component-tabs"] [data-target] a',function(c){b=a(this).parent(),c.preventDefault(),g(b),f(b)})},_setupResponsiveSelector:function(){var b,c,d,e,f,g=this;g.$el.on("change",'*[data-object="blocks-doc-component-responsive_selector"]',function(){b=a(this),c=b.find(":selected"),d=b.closest(".is-resizable").find(".ui-resizable"),f=parseInt(1*c.attr("value").split("x")[0]+g.FRAME_CONTAINER_PADDING,10),e=parseInt(1*c.attr("value").split("x")[1]+g.FRAME_CONTAINER_PADDING,10),d.animate({width:f,height:e})})},_setTemplateURI:function(){var a=this,b=a.$el.attr("data-viewer_template");a.config.viewer_template_uri=a.opts.viewer_template_uri,void 0!==b&&(a.config.viewer_template_uri=b)},_setupLogging:function(){var a,b=this,c=void 0!==b.config.logging?b.config.logging:b.LOGGING,d=["error","warn","info","debug","log"];window.debug={},void 0===typeof window.console&&(window.console={}),a=window.console,_.each(d,function(b){window.debug[b]=function(){c===!0&&a[b].apply(a,arguments)}})}};var k=a.fn.BlocksViewer;a.fn.BlocksViewer=function(b){return this.each(function(){var c=a(this),d=c.data("BlocksViewer"),e=a.extend({},a.fn.BlocksViewer.defaults,c.data(),"object"==typeof b&&b);d||c.data("BlocksViewer",d=new i(this,e)),"string"==typeof b&&d[b]()})},a.fn.BlocksViewer.defaults={config_path:"",blocks_loader:"../blocks/build/blocks-loader-2.1.3.min.js",viewer_template_uri:"viewer-template.html",components:{source:"components/"}},a.fn.BlocksViewer.Constructor=i,a.fn.BlocksViewer.noConflict=function(){return a.fn.BlocksViewer=k,this},a(window).on("load",function(){a("body").BlocksViewer()}),a(window).on("resize",function(){g(f(),1e3)}),a(c).on("blocks-done-inside-viewer",function(a,b){var c=b.iframe_id;e(c)})}(window.jQuery,window.console,document);