!function(a,b,c){"use strict";var d=function(b,c){this.$el=a(b),this.config=null,this.opts=c,this.components=[],this.cache={},this.FRAME_CONTAINER_PADDING=28,this.RESPONSIVE_SIZES=["320x444","360x640","600x800","768x1024","800x1280","980x1280","1280x600","1900x900"],this.LOGGING=!0,this.loadConfig(c),this._setupLogging(),this.init()},e=function(a){this.cache={},this.page=a.page,this.config=this.page.config,this.index=a.index,this.init(a.component)};e.prototype={init:function(a){var b=this;b.$component=a,b.$revised_component="",b.template=b.$component.html(),b.width=parseInt(b.$component.attr("data-frame-width"),10),b.height=parseInt(b.$component.attr("data-frame-height"),10),b._setFrameName(),b._setFrameID(),b._setFrameContainerID(),b._setFrameProperties(),b._setFigure(),b.createFrame()},createFrame:function(){var a=this;a._createFrameComponents(),a._createFrame(),a._wrapFrame(),a._replaceComponentReferenceWithFrame(),a._makeFrameResizable(),a._addBasicStyling(),a._autoZoomOnResize()},_createFrameComponents:function(){var b=this;if(b.frame_properties.resizable===!0){var c,d=a('<span data-object="blocks-doc-component-responsive_selector"></span>'),e=a("<select></select>");_.each(b.page.RESPONSIVE_SIZES,function(b){c=a("<option></option>"),c.attr("value",b).text(b),e.append(c)}),d.addClass("b-responsive_sizes").append(e),b.$responsive_selector=d}},_createFrame:function(){var b=this;b.$frame=a("<iframe></iframe>"),b.$frame.attr("id",b.id),b.$frame.attr("src",b.config.viewer_template_uri),b.$frame.attr("frameborder","0"),b.$frame.attr("sandbox","allow-same-origin allow-forms allow-scripts"),b.$frame.attr("seamless",!0),b.$frame.attr("scrolling",b.frame_properties.scrollable),b.$frame.css("width","100%"),b.$frame.css("height","100%")},_wrapFrame:function(){var b=this,c=a("<div></div>"),d=a("<div></div>"),e=a("<p></p>");c.addClass("b-frame_container"),c.attr("id",b.frame_container_ID),c.append(b.$frame),e.addClass("b-figure").text(b.figure),"object"==typeof b.$responsive_selector&&e.append(b.$responsive_selector),d.addClass("b-viewer_container"),d.append(e),d.append(c),b.$viewerContainer=d},_replaceComponentReferenceWithFrame:function(){var a=this;a.$frame.bind("load",function(){a._injectComponentInFrame()}),a.$component.replaceWith(a.$viewerContainer)},_injectComponentInFrame:function(){var b,c=this,d=c._cleanComponent();b=window.document.getElementById(c.id).contentWindow.document,c.$iframe=a("html",b),c.$iframe.find("body").append(d);var e=b.createElement("script");e.src=c.config.blocks_loader,b.head.appendChild(e);var f=setInterval(function(){"function"==typeof window.document.getElementById(c.id).contentWindow.$&&"function"==typeof window.document.getElementById(c.id).contentWindow.$("body").BlocksLoader&&(clearInterval(f),window.document.getElementById(c.id).contentWindow.$("body").on("blocks-done",function(){c._setHeightAndWidth()}),window.document.getElementById(c.id).contentWindow.$("body").BlocksLoader())},500)},_makeFrameResizable:function(){var b=this;b.frame_properties.resizable===!0&&a("#"+b.frame_container_ID).resizable({start:function(){var c=a(this).find("iframe"),d=a("<div></div>");b.$viewerContainer.find(".b-frame_container").append(d[0]),d[0].id="temp_div",d.css({position:"absolute"}),d.css({top:c.position().top,left:0}),d.height(c.height()),d.width("100%")},stop:function(){a("#temp_div").remove()}}).parent().addClass("is-resizable")},_cleanComponent:function(){var a=this,b=a.$component.clone(),c=b.attr("data-frame-component");return b.attr("data-component",c),b.removeAttr("data-frame-component"),b.removeAttr("data-frame-width"),b.removeAttr("data-frame-height"),b},_setFrameID:function(){var a=this;a.id=a.$component.attr("id")?a.$component.attr("id"):a.name+"-"+a.index},_setFrameContainerID:function(){var a=this;a.frame_container_ID="container-"+a.id},_setFrameName:function(){var a=this;a.name=a.$component.attr("data-frame-component")+"-frame"},_setFrameProperties:function(){var a,b=this,c={width:"auto",height:"auto",resizable:!1,scale:"",scrollable:!1,zoomable:!1,"zoomable-annotation":!1,"zoom-levels":[1,.66,.5,.33]};b.frame_properties={},_.each(c,function(c,d){if(a="data-frame-"+d,void 0!==b.$component.attr(a)&&""!==b.$component.attr(a)){var e=b.$component.attr(a);window.debug.debug(e),"true"===e?e=!0:"false"===e&&(e=!1),b.frame_properties[d]=e}else void 0!==b.config.frame?void 0!==b.config.frame[d]&&(b.frame_properties[d]=b.config.frame[d]):b.frame_properties[d]=c}),b.frame_properties.scrollable=1==b.frame_properties.scrollable?"yes":"no","auto"==b.frame_properties.zoomable&&(b.frame_properties.resizable=!1),window.debug.debug(b.frame_properties)},_setFigure:function(){var a=this;a.figure=a.$component.attr("data-figure")},_addBasicStyling:function(){var b=this;("undefined"==typeof b.config.use_blocks_viewer_default_styles||1==b.config.use_blocks_viewer_default_styles)&&(b.$viewerContainer.css({background:"lightblue",padding:"10px"}),b.$viewerContainer.find(".b-figure").css({padding:"0",margin:"0"}),b.$viewerContainer.find(".b-frame_container").css({display:"inline-block",border:"solid 1px black",margin:"0",padding:"0",position:"relative"}),b.$viewerContainer.find(".ui-resizable-handle.ui-resizable-e").css({position:"absolute",top:"0",width:"7px",height:"100%",background:"red",display:"block",right:"-7px",cursor:"e-resize"}),b.$viewerContainer.find(".ui-resizable-handle.ui-resizable-s").css({position:"absolute",bottom:"-7px",height:"7px",width:"100%",background:"red",display:"block",left:"0",cursor:"s-resize"}),b.$viewerContainer.find(".ui-resizable-handle.ui-resizable-se").css({position:"absolute",bottom:"-7px",height:"7px",width:"7px",background:"green",display:"block",right:"-7px",cursor:"se-resize"}),0==a(".viewer-style-warning").length&&(a("body").prepend("<div class='viewer-style-warning'>The Default Blocks Styles are Being used. To override and use your own Blocks Viewer Styles, set 'use_blocks_viewer_default_styles' to false in your Blocks config.json)</div>"),a(".viewer-style-warning").css({position:"fixed",top:0,width:"100%",background:"red",padding:"10px",color:"white","font-family":"sans-serif"})))},_updateResizableValues:function(){var a=this;if(a.frame_properties.resizable===!0){var b=a.$frame.css("height"),c=a.$frame.css("width"),d=c.replace("px","")+"x"+b.replace("px","");0==a.$responsive_selector.find("select").find("option[value='"+d+"']").length&&a.$responsive_selector.find("select").prepend("<option value='"+d+"' selected>"+d+"</option>")}},_autoSizeHeight:function(){var a=this;setTimeout(function(){a.$frame.css("height","0");var b=a.$frame[0].contentWindow.document.documentElement.scrollHeight;a.$viewerContainer.find(".b-frame_container").css("height",b+"px"),a.$frame.css("height","100%"),a._updateResizableValues()},500)},_autoSizeWidth:function(){var a=this;setTimeout(function(){a.$frame.css("width","0");var b=a.$frame[0].contentWindow.document.documentElement.scrollWidth;a.$viewerContainer.find(".b-frame_container").css("width",b+"px"),a.$frame.css("width","100%"),a._updateResizableValues()},500)},_setHeightAndWidth:function(){var a=this;a.$frame.css({height:"100%",width:"100%"}),"auto"!==a.frame_properties.height?a.$viewerContainer.find(".b-frame_container").css("height",a.frame_properties.height):a._autoSizeHeight(),"auto"!==a.frame_properties.width?(window.debug.debug("Set container Width: "+a.frame_properties.width),a.$viewerContainer.find(".b-frame_container").css("width",a.frame_properties.width)):a._autoSizeWidth(),setInterval(function(){a._setupAutoZoom()},500)},_setupAutoZoom:function(b){var c=this,b=void 0==typeof b?500:b;"auto"==c.frame_properties.zoomable&&setTimeout(function(){c.$frame.parent().css({width:"100%","max-width":c.frame_properties.width+"px"});var b=c.$viewerContainer.find(".b-frame_container").width(),d=Math.min(b/c.frame_properties.width,1);if(1==c.frame_properties["zoomable-annotation"]){var e=c.$viewerContainer.find(".b-zoomable-annotation");0==e.length&&(e=a("<p class='b-zoomable-annotation'></p>"),c.$viewerContainer.find(".b-figure").after(e)),e.html("Displayed in viewport <span class='auto-zoom-width'>"+c.frame_properties.width+"px wide</span> @ <span class='auto-zoom-percentage'>"+Math.round(100*d)+"%</span> scale")}c.$frame.css({width:c.frame_properties.width+"px","-webkit-transform-origin":"0 0","-webkit-transform":"scale("+d+")","transform-origin":"0 0",transform:"scale("+d+")"});var f=c.$frame[0].contentWindow.document.documentElement.scrollHeight,g=f*d;c.$frame.parent().css({height:g+"px"}),c.$frame.css({height:f+"px"});var h=c.$viewerContainer.height()-f-scale_height;c.$viewerContainer.css({height:h+"px"})},b)},_autoZoomOnResize:function(){var b=this;"auto"==b.frame_properties.zoomable&&a(window).on("resize",function(){b._setupAutoZoom(0)})}},d.prototype={constructor:d,loadConfig:function(b){var c=this,d=b.config_path+"config.json",e={type:"GET",dataType:"json",async:!1,cache:!1,url:d,timeout:3e4,success:function(d){c.config=a.extend(b,d)},error:function(a){window.console.error("FAILED TO FETCH CONFIG: "+d+" returned "+JSON.stringify(a)),c.config=b}};a.ajax(e)},init:function(){var b=this,d=0;b.name=a(c).find("head title").text(),b._setTemplateURI(),b._enableJS(),b.$el.find("*[data-frame-component]").each(function(){var c;d++,c=new e({page:b,component:a(this),index:d})}),b._setupPage()},_setupPage:function(){var a=this;a._setupResponsiveSelector(),a._enableTabs()},_enableJS:function(){a(c).find("html").removeClass("no-js").addClass("js")},_enableTabs:function(){var b,c=this,d=c.$el.find('*[data-object="blocks-doc-component-tabs"]'),e=d.find('[data-state="is-active"]'),f=function(a){var b=a.attr("data-target"),c=a.parent().parent().find(b);c.siblings().attr("data-state","is-inactive"),c.attr("data-state","is-active")},g=function(a){a.siblings().attr("data-state","is-inactive"),a.attr("data-state","is-active")};f(e),c.$el.on("click",'*[data-object="blocks-doc-component-tabs"] [data-target] a',function(c){b=a(this).parent(),c.preventDefault(),g(b),f(b)})},_setupResponsiveSelector:function(){var b,c,d,e,f,g=this;g.$el.on("change",'*[data-object="blocks-doc-component-responsive_selector"]',function(){b=a(this),c=b.find(":selected"),d=b.closest(".is-resizable").find(".ui-resizable"),f=parseInt(1*c.attr("value").split("x")[0]+g.FRAME_CONTAINER_PADDING,10),e=parseInt(1*c.attr("value").split("x")[1]+g.FRAME_CONTAINER_PADDING,10),d.animate({width:f,height:e})})},_setTemplateURI:function(){var a=this,b=a.$el.attr("data-viewer_template");a.config.viewer_template_uri=a.opts.viewer_template_uri,void 0!==b&&(a.config.viewer_template_uri=b)},_setupLogging:function(){var a,b=this,c=void 0!==b.config.logging?b.config.logging:b.LOGGING,d=["error","warn","info","debug","log"];window.debug={},void 0===typeof window.console&&(window.console={}),a=window.console,_.each(d,function(b){window.debug[b]=function(){c===!0&&a[b].apply(a,arguments)}})}};var f=a.fn.BlocksViewer;a.fn.BlocksViewer=function(b){return this.each(function(){var c=a(this),e=c.data("BlocksViewer"),f=a.extend({},a.fn.BlocksViewer.defaults,c.data(),"object"==typeof b&&b);e||c.data("BlocksViewer",e=new d(this,f)),"string"==typeof b&&e[b]()})},a.fn.BlocksViewer.defaults={config_path:"",blocks_loader:"../blocks/build/blocks-loader-2.1.3.min.js",viewer_template_uri:"viewer-template.html",components:{source:"components/"}},a.fn.BlocksViewer.Constructor=d,a.fn.BlocksViewer.noConflict=function(){return a.fn.BlocksViewer=f,this},a(window).on("load",function(){a("body").BlocksViewer()})}(window.jQuery,window.console,document);