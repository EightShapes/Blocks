!function(a,b,c){"use strict";var d=function(b,c){this.$el=a(b),this.config=null,this.opts=c,this.components=[],this.cache={},this.FRAME_CONTAINER_PADDING=28,this.RESPONSIVE_SIZES=["320x444","360x640","600x800","768x1024","800x1280","980x1280","1280x600","1900x900"],this.LOGGING=!0,this.loadConfig(c),this._setupLogging(),this.init()},e=function(a){this.cache={},this.page=a.page,this.config=this.page.config,this.index=a.index,this.init(a.component)};e.prototype={init:function(a){var b=this;b.$component=a,b.$revised_component="",b.template=b.$component.html(),b._setFrameName(),b._setFrameID(),b._setFrameContainerID(),b._setFrameProperties(),b._setFigure(),b.createFrame()},createFrame:function(){var a=this;a._createFrameComponents(),a._createFrame(),a._wrapFrame(),a._replaceComponentReferenceWithFrame(),a._makeFrameResizable(),a._autoZoomOnResize()},_createFrameComponents:function(){var b=this;if(b.frame_properties.resizable===!0){var c,d=a('<span data-object="blocks-doc-component-responsive_selector"></span>'),e=a("<select></select>");_.each(b.page.RESPONSIVE_SIZES,function(b){c=a("<option></option>"),c.attr("value",b).text(b),e.append(c)}),d.addClass("b-responsive_sizes").append(e),b.$responsive_selector=d}},_createFrame:function(){var b=this;b.$frame=a("<iframe></iframe>"),b.$frame.attr("id",b.id),b.$frame.attr("src",b.config.viewer_template_uri),b.$frame.attr("frameborder","0"),b.$frame.attr("sandbox","allow-same-origin allow-forms allow-scripts"),b.$frame.attr("seamless",!0),b.$frame.attr("scrolling",b.frame_properties.scrollable),b.$frame.css("width","100%"),b.$frame.css("height","100%")},_wrapFrame:function(){var b=this,c=a("<div></div>"),d=a("<div></div>"),e=a("<p></p>");c.addClass("b-frame_container"),c.attr("id",b.frame_container_ID),c.append(b.$frame),e.addClass("b-figure").text(b.figure),"object"==typeof b.$responsive_selector&&e.append(b.$responsive_selector),d.addClass("b-viewer_container"),d.append(e),d.append(c),b.$viewerContainer=d},_replaceComponentReferenceWithFrame:function(){var a=this;a.$frame.bind("load",function(){a._injectComponentInFrame()}),a.$component.replaceWith(a.$viewerContainer)},_injectComponentInFrame:function(){var b,c,d,e=this,f=e._cleanComponent();b=window.document.getElementById(e.id).contentWindow.document,e.$iframe=a("html",b),e.$iframe.find("body").append(f),c=b.createElement("script"),c.src=e.config.blocks_loader,b.head.appendChild(c),d=setInterval(function(){"function"==typeof window.document.getElementById(e.id).contentWindow.$&&"function"==typeof window.document.getElementById(e.id).contentWindow.$("body").BlocksLoader&&(clearInterval(d),window.document.getElementById(e.id).contentWindow.$("body").on("blocks-done",function(){e._setHeightAndWidth()}),window.document.getElementById(e.id).contentWindow.$("body").BlocksLoader())},500)},_makeFrameResizable:function(){var b=this;b.frame_properties.resizable===!0&&a("#"+b.frame_container_ID).resizable({start:function(){var c=a(this).find("iframe"),d=a("<div></div>");b.$viewerContainer.find(".b-frame_container").append(d[0]),d[0].id="temp_div",d.css({position:"absolute"}),d.css({top:c.position().top,left:0}),d.height(c.height()),d.width("100%")},stop:function(){a("#temp_div").remove()}}).parent().addClass("is-resizable")},_cleanComponent:function(){var a=this,b=a.$component.clone(),c=b.attr("data-frame-component");return b.attr("data-component",c),b.removeAttr("data-frame-component"),b.removeAttr("data-frame-width"),b.removeAttr("data-frame-height"),b},_setFrameID:function(){var a=this;a.id=a.$component.attr("id")?a.$component.attr("id"):a.name+"-"+a.index},_setFrameContainerID:function(){var a=this;a.frame_container_ID="container-"+a.id},_setFrameName:function(){var a=this;a.name=a.$component.attr("data-frame-component")+"-frame"},_setFrameProperties:function(){var a,b=this,c={width:"auto",height:"auto",resizable:!1,scale:"",scrollable:!1,zoomable:!1,"zoomable-annotation":!1,"zoom-levels":[1,.66,.5,.33]};b.frame_properties={},_.each(c,function(c,d){if(a="data-frame-"+d,void 0!==b.$component.attr(a)&&""!==b.$component.attr(a)){var e=b.$component.attr(a);"true"===e?e=!0:"false"===e&&(e=!1),b.frame_properties[d]=e}else void 0!==b.config.frame?void 0!==b.config.frame[d]&&(b.frame_properties[d]=b.config.frame[d]):b.frame_properties[d]=c}),b.frame_properties.scrollable=b.frame_properties.scrollable===!0?"yes":"no","auto"==b.frame_properties.zoomable&&(b.frame_properties.resizable=!1)},_setFigure:function(){var a=this;a.figure=a.$component.attr("data-figure")},_updateResizableValues:function(){var a,b,c,d=this;d.frame_properties.resizable===!0&&(a=d.$frame.css("height"),b=d.$frame.css("width"),c=b.replace("px","")+"x"+a.replace("px",""),0===d.$responsive_selector.find("select").find("option[value='"+c+"']").length&&d.$responsive_selector.find("select").prepend("<option value='"+c+"' selected>"+c+"</option>"))},_autoSizeHeight:function(){var a,b,c=this;setTimeout(function(){c.$frame.css("height","0"),a=c.$frame[0].contentWindow.document.documentElement.scrollHeight,b=c.$frame.parent().outerHeight()-c.$frame.parent().height(),c.$viewerContainer.find(".b-frame_container").css("height",a+b+"px"),c.$frame.css("height","100%"),c._updateResizableValues()},500)},_autoSizeWidth:function(){var a,b=this;setTimeout(function(){b.$frame.css("width","0"),a=b.$frame[0].contentWindow.document.documentElement.scrollWidth,b.$viewerContainer.find(".b-frame_container").css("width",a+"px"),b.$frame.css("width","100%"),b._updateResizableValues()},500)},_setHeightAndWidth:function(){var a=this;a.$frame.css({height:"100%",width:"100%"}),"auto"!==a.frame_properties.height?-1!=a.frame_properties.height.indexOf("%")?a.$viewerContainer.find(".b-frame_container").css("height",a.frame_properties.height):a.$viewerContainer.find(".b-frame_container").height(a.frame_properties.height):a._autoSizeHeight(),"auto"!==a.frame_properties.width?-1!=a.frame_properties.width.indexOf("%")?a.$viewerContainer.find(".b-frame_container").css("width",a.frame_properties.width):a.$viewerContainer.find(".b-frame_container").width(a.frame_properties.width):a._autoSizeWidth(),setTimeout(function(){a._setupAutoZoom()},500)},_setupAutoZoom:function(b){var c,d,e,f,g,h,i=this;b=void 0===typeof b?500:b,"auto"==i.frame_properties.zoomable&&setTimeout(function(){i.$frame.parent().css({width:"100%","max-width":i.frame_properties.width+"px"}),c=i.$viewerContainer.find(".b-frame_container").width(),d=Math.min(c/i.frame_properties.width,1),i.frame_properties["zoomable-annotation"]===!0&&(h=i.$viewerContainer.find(".b-zoomable-annotation"),0===h.length&&(h=a("<p class='b-zoomable-annotation'></p>"),i.$viewerContainer.find(".b-figure").after(h)),h.html("Displayed in viewport <span class='auto-zoom-width'>"+i.frame_properties.width+"px wide</span> @ <span class='auto-zoom-percentage'>"+Math.round(100*d)+"%</span> scale")),i.$frame.css({width:i.frame_properties.width+"px","-webkit-transform-origin":"0 0","-webkit-transform":"scale("+d+")","transform-origin":"0 0",transform:"scale("+d+")"}),e=i.$frame.parent().outerHeight()-i.$frame.parent().height(),f=i.$frame[0].contentWindow.document.documentElement.scrollHeight,g=f*d+e,i.$frame.parent().css({height:g+"px"}),i.$frame.css({height:f+"px"})},b)},_autoZoomOnResize:function(){var a=this;"auto"==a.frame_properties.zoomable&&_.throttle(a._setupAutoZoom(0),1e3)}},d.prototype={constructor:d,loadConfig:function(b){var c=this,d=b.config_path+"config.json",e={type:"GET",dataType:"json",async:!1,cache:!1,url:d,timeout:3e4,success:function(d){c.config=a.extend(b,d)},error:function(a){window.console.error("FAILED TO FETCH CONFIG: "+d+" returned "+JSON.stringify(a)),c.config=b}};a.ajax(e)},init:function(){var b=this,d=0;b.name=a(c).find("head title").text(),b._setTemplateURI(),b._enableJS(),b.$el.find("*[data-frame-component]").each(function(){var c;d++,c=new e({page:b,component:a(this),index:d})}),b._setupPage()},_setupPage:function(){var a=this;a._setupResponsiveSelector(),a._enableTabs()},_enableJS:function(){a(c).find("html").removeClass("no-js").addClass("js")},_enableTabs:function(){var b,c=this,d=c.$el.find('*[data-object="blocks-doc-component-tabs"]'),e=d.find('[data-state="is-active"]'),f=function(a){var b=a.attr("data-target"),c=a.parent().parent().find(b);c.siblings().attr("data-state","is-inactive"),c.attr("data-state","is-active")},g=function(a){a.siblings().attr("data-state","is-inactive"),a.attr("data-state","is-active")};f(e),c.$el.on("click",'*[data-object="blocks-doc-component-tabs"] [data-target] a',function(c){b=a(this).parent(),c.preventDefault(),g(b),f(b)})},_setupResponsiveSelector:function(){var b,c,d,e,f,g=this;g.$el.on("change",'*[data-object="blocks-doc-component-responsive_selector"]',function(){b=a(this),c=b.find(":selected"),d=b.closest(".is-resizable").find(".ui-resizable"),f=parseInt(1*c.attr("value").split("x")[0]+g.FRAME_CONTAINER_PADDING,10),e=parseInt(1*c.attr("value").split("x")[1]+g.FRAME_CONTAINER_PADDING,10),d.animate({width:f,height:e})})},_setTemplateURI:function(){var a=this,b=a.$el.attr("data-viewer_template");a.config.viewer_template_uri=a.opts.viewer_template_uri,void 0!==b&&(a.config.viewer_template_uri=b)},_setupLogging:function(){var a,b=this,c=void 0!==b.config.logging?b.config.logging:b.LOGGING,d=["error","warn","info","debug","log"];window.debug={},void 0===typeof window.console&&(window.console={}),a=window.console,_.each(d,function(b){window.debug[b]=function(){c===!0&&a[b].apply(a,arguments)}})}};var f=a.fn.BlocksViewer;a.fn.BlocksViewer=function(b){return this.each(function(){var c=a(this),e=c.data("BlocksViewer"),f=a.extend({},a.fn.BlocksViewer.defaults,c.data(),"object"==typeof b&&b);e||c.data("BlocksViewer",e=new d(this,f)),"string"==typeof b&&e[b]()})},a.fn.BlocksViewer.defaults={config_path:"",blocks_loader:"../blocks/build/blocks-loader-2.1.3.min.js",viewer_template_uri:"viewer-template.html",components:{source:"components/"}},a.fn.BlocksViewer.Constructor=d,a.fn.BlocksViewer.noConflict=function(){return a.fn.BlocksViewer=f,this};var g=a("script[data-blocks='true']"),h=!0;g.length>0&&"false"==g.attr("data-autoload")&&(h=!1),h===!0&&a(window).on("load",function(){a("body").BlocksViewer()})}(window.jQuery,window.console,document);